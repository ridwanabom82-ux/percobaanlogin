<?php
session_start();
date_default_timezone_set("Asia/Jakarta");

/* ================= CONFIG ================= */
$USERNAME_VALID = "costumer xennzyy";
$OTP_EXPIRE = 3600; // 1 jam

/* ================= FUNCTION ================= */
function generateOTP() {
    $timePart = date("dmyH"); // waktu
    $randomPart = rand(100,999); // angka acak
    return $timePart . $randomPart;
}

/* ================= LOGIC ================= */
$alert = "";

if (isset($_POST['generate'])) {
    $_SESSION['otp'] = generateOTP();
    $_SESSION['otp_time'] = time();
}

if (isset($_POST['login'])) {
    $user = $_POST['username'] ?? '';
    $pass = $_POST['password'] ?? '';

    if ($user !== $USERNAME_VALID) {
        $alert = "âŒ Username salah!";
    } elseif (!isset($_SESSION['otp'])) {
        $alert = "âŒ Silakan minta password terlebih dahulu!";
    } elseif (time() - $_SESSION['otp_time'] > $OTP_EXPIRE) {
        $alert = "âŒ Password sudah kadaluarsa!";
        unset($_SESSION['otp']);
    } elseif ($pass !== $_SESSION['otp']) {
        $alert = "âŒ Password salah!";
    } else {
        $_SESSION['login'] = true;
        unset($_SESSION['otp']); // HANGUS
        header("Location: index.php");
        exit;
    }
}

if (isset($_GET['logout'])) {
    session_destroy();
    header("Location: index.php");
    exit;
}
?>

<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Login Toko XennZyy</title>
<style>
body{
    margin:0;
    font-family:Arial;
    background:url('https://files.catbox.moe/qjwzka.png') no-repeat center fixed;
    background-size:cover;
}
.box{
    max-width:420px;
    margin:60px auto;
    background:rgba(0,0,0,.8);
    padding:25px;
    border-radius:10px;
    color:white;
}
.logo{text-align:center}
.logo img{width:120px}
input,button{
    width:100%;
    padding:10px;
    margin-top:10px;
    border-radius:6px;
    border:none;
}
button{
    background:#00ffcc;
    font-weight:bold;
    cursor:pointer;
}
.alert{color:#ff6b6b;margin-top:10px}
.note{font-size:12px;color:#ccc;margin-top:10px}
.cs{
    background:#25D366;
    color:white;
}
</style>
</head>
<body>

<?php if (!isset($_SESSION['login'])): ?>
<!-- LOGIN PAGE -->
<div class="box">
    <div class="logo">
        <img src="https://files.catbox.moe/4dcvwa.png">
    </div>

    <form method="post">
        <input type="text" name="username" placeholder="Username" required>
        <input type="password" name="password" placeholder="Password" required>

        <button name="login">LOGIN</button>
        <button name="generate">MINTA PASSWORD</button>
    </form>

    <?php if (isset($_SESSION['otp'])): ?>
        <div class="alert">
            Password sementara anda:<br>
            <b><?= $_SESSION['otp'] ?></b><br>
            (Berlaku 1 jam & sekali pakai)
        </div>
    <?php endif; ?>

    <?php if ($alert): ?>
        <div class="alert"><?= $alert ?></div>
    <?php endif; ?>

    <div class="note">
        (Untuk Username anda harus meminta ke admin XennZyy)
    </div>

    <a href="https://wa.me/6281313156016?text=*BANG+USERNAME+WEBNYA+APA+WOILAHðŸ˜¹*" target="_blank">
        <button class="cs">CS : XennZyy</button>
    </a>
</div>

<?php else: ?>
<!-- DUMMY PAGE (HALAMAN 2 BELUM FINAL) -->
<div class="box">
    <h2>âœ… Login Berhasil</h2>
    <p>Halaman produk belum dibuat.</p>
    <p>Ini hanya halaman percobaan login.</p>

    <a href="?logout=true">
        <button>LOGOUT</button>
    </a>
</div>
<?php endif; ?>

</body>
  </html>
